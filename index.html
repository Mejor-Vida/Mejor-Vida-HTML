<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mejor Vida Insurance - Seguro de Gastos Finales</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- Font Awesome for social + contact icons -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <style>
    /* Logo size updated to 150px height */
    .logo img,
    #header-logo,
    .header-logo-img {
      height: 150px;
      width: auto;
      max-width: 100%;
    }

    /* Footer social icons colored and aligned right */
    .footer-bottom {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .footer-left {
      flex: 1 1 auto;
      min-width: 250px;
    }
    .footer-right {
      flex: 0 0 auto;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .footer-right a {
      font-size: 1.5rem;
      color: inherit;
      transition: transform 0.3s ease;
    }
    .footer-right a:hover {
      transform: scale(1.2);
    }
    .footer-right a .fab {
      /* Colored icons */
      color: #3b5998; /* Facebook blue */
    }
    .footer-right a[aria-label="Instagram"] .fab {
      color: #e4405f; /* Instagram pink */
    }
    .footer-right a[aria-label="LinkedIn"] .fab {
      color: #0077b5; /* LinkedIn blue */
    }

    /* ---------- Modal styles for embedded Agent CRM form ---------- */
    .quote-modal {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 9999;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }
    .quote-modal[aria-hidden="false"] {
      display: flex;
    }
    .quote-modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.45);
    }

    /* Panel is column flex so header stays at top and iframe area fills remaining space */
    .quote-modal-panel {
      position: relative;
      background: #fff;
      width: 96%;
      max-width: 1100px;
      border-radius: 8px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.25);
      overflow: hidden;
      max-height: 95vh;          /* allow almost full viewport height */
      display: flex;
      flex-direction: column;
      outline: none;
    }

    /* Header inside modal (logo left, centered title, close right) */
    .quote-modal-header {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 20px;
      background: #ffffff;
      border-bottom: 1px solid #eee;
      flex: 0 0 auto;
      position: relative;       /* allows absolute centering of title */
    }

    /* Logo same size as other pages */
    .quote-modal-header .modal-logo img {
      height: 150px;            /* match your other pages */
      width: auto;
      display: block;
    }

    /* Centered title block in header */
    .quote-modal-header .modal-title-wrap {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      pointer-events: none;     /* keep clicks for close button/links unaffected */
      width: calc(100% - 220px);/* leave room for logo + close button */
    }

    /* Title/subtitle styles (bigger) */
    .quote-modal-title {
      font-size: 20px;
      font-weight: 700;
      color: #111827;
    }
    .quote-modal-subtitle {
      font-size: 14px;
      color: #6b7280;
      margin-top: 3px;
    }

    /* Close button sits above header content on the right */
    .quote-modal-close {
      position: absolute;
      right: 12px;
      top: 12px;
      background: transparent;
      border: 0;
      font-size: 28px;
      line-height: 1;
      cursor: pointer;
      color: #111;
      padding: 6px;
      z-index: 4;
    }

    /* iframe area fills remaining panel height and allows iframe to show scrollbars */
    .quote-iframe-wrap {
      width: 100%;
      flex: 1 1 auto;
      background: #fff;
      display: flex;
      min-height: 320px;
    }
    .quote-iframe-inner {
      flex: 1 1 auto;
      height: 100%;
      overflow: hidden;            /* hide extra; iframe will have its own scrollbar */
      -webkit-overflow-scrolling: touch;
      padding: 0;                  /* keep iframe flush */
      box-sizing: border-box;
    }
    .quote-iframe-inner iframe {
      width: 100%;
      border: 0;
      display: block;
      min-height: 700px;           /* baseline */
      /* We'll set the actual height dynamically via JS to fit the viewport */
    }

    @media (max-width: 600px) {
      .quote-modal-panel { width: 98%; max-width: 98%; border-radius: 6px; }
      .quote-modal-header .modal-logo img { height: 110px; }
      .quote-modal-title { font-size: 18px; }
    }

    /* visually-hidden helper */
    .sr-only { position:absolute !important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; border:0; padding:0; margin:-1px; }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="container header-container">
      <div class="logo">
        <a href="#home" class="logo-link">
          <img
            id="header-logo"
            class="header-logo-img"
            src="img/logo-spanish.png"
            alt="Mejor Vida Insurance logo"
          />
        </a>
      </div>

      <div class="header-right">
        <!-- Flag buttons on top -->
        <div class="lang-toggle">
          <button class="lang-btn active" data-lang-btn="es">
            <span class="flag">üá™üá∏</span> ES
          </button>
          <button class="lang-btn" data-lang-btn="en">
            <span class="flag">üá∫üá∏</span> EN
          </button>
        </div>

        <!-- Nav links below flags -->
        <nav class="nav">
          <a href="#about" data-lang="es">Sobre Julie</a>
          <a href="#about" data-lang="en" style="display:none;">About Julie</a>

          <a href="#how-it-works" data-lang="es">C√≥mo funciona</a>
          <a href="#how-it-works" data-lang="en" style="display:none;">How it works</a>

          <a href="#carriers" data-lang="es">Aseguradoras</a>
          <a href="#carriers" data-lang="en" style="display:none;">Carriers</a>

          <!-- UPDATED: buttons now open the Agent CRM modal (no quote.html links) -->
          <a href="#" class="open-quote-modal" data-lang="es" role="button" aria-pressed="false">Cotizaci√≥n gratis</a>
          <a href="#" class="open-quote-modal" data-lang="en" style="display:none;" role="button" aria-pressed="false">Free quote</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero" id="home">
    <div class="container hero-container">
      <div class="hero-text">
        <span class="hero-badge" data-lang="es">
          Seguro de vida para gastos finales, explicado en un lenguaje sencillo
        </span>
        <span class="hero-badge" data-lang="en" style="display:none;">
          Simple final expense life insurance for your family's peace of mind
        </span>

        <h1 data-lang="es">Protege a tu familia con un seguro de gastos finales sencillo</h1>
        <h1 data-lang="en" style="display:none;">Protect your family with simple final expense coverage</h1>

        <p class="hero-subheading" data-lang="es">
          En Mejor Vida Insurance, te ayudamos a encontrar un seguro de vida para gastos finales que se ajuste a tu
          presupuesto y a tu situaci√≥n, trabajando con compa√±√≠as de confianza como Aetna y Mutual of Omaha.
        </p>
        <p class="hero-subheading" data-lang="en" style="display:none;">
          At Mejor Vida Insurance, we help you find final expense life insurance that fits your budget and situation,
          working with trusted companies like Aetna and Mutual of Omaha.
        </p>

        <div class="hero-card">
          <div class="hero-trust">
            <h3 data-lang="es">Orientaci√≥n personal, sin presi√≥n</h3>
            <h3 data-lang="en" style="display:none;">Personal, no‚Äëpressure guidance</h3>
            <p data-lang="es">
              En Mejor Vida Insurance nos tomamos el tiempo para escuchar tu situaci√≥n, explicarte tus opciones paso a paso
              y responder tus preguntas con calma, sin compromiso ni presi√≥n.
            </p>
            <p data-lang="en" style="display:none;">
              At Mejor Vida Insurance, we take the time to understand your situation, explain your options step by step,
              and answer your questions calmly, with no obligation or pressure.
            </p>
          </div>

          <div class="hero-highlight">
            <h3 data-lang="es">Pensado para cubrir gastos finales</h3>
            <h3 data-lang="en" style="display:none;">Designed to help with final expenses</h3>
            <p data-lang="es">
              La cobertura puede ayudar a tu familia con los costos de funeral, entierro, facturas m√©dicas y otras deudas,
              para que tengan un poco m√°s de tranquilidad en un momento dif√≠cil.
            </p>
            <p data-lang="en" style="display:none;">
              Coverage can help your family with funeral and burial costs, medical bills, and other debts so they have a bit
              more peace of mind during a difficult time.
            </p>
          </div>

          <div class="hero-contact">
            <p>
              <!-- UPDATED: buttons now open modal (no quote.html) -->
              <a href="#" class="btn btn-primary open-quote-modal" data-lang="es" role="button" aria-pressed="false">¬°Obt√©n una cotizaci√≥n gratis!</a>
              <a href="#" class="btn btn-primary open-quote-modal" data-lang="en" style="display:none;" role="button" aria-pressed="false">Get a free quote!</a>
            </p>
          </div>
        </div>
      </div>

      <div class="hero-image">
        <img
          src="img/hispanic-family-laughing.jpg"
          alt="Familia hispana sonriendo y protegida con seguro de vida"
        />
      </div>
    </div>
  </section>

  <!-- ABOUT JULIE (rest of content unchanged) -->
  <!-- ... keep the rest of your content exactly as it was ... -->

  <!-- CARRIERS, FOOTER etc. (kept as in your original file) -->
  <!-- For brevity I keep the rest of the page content unchanged ‚Äî ensure you paste your full page content here if any sections were removed. -->

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container footer-bottom">
      <div class="footer-left">
        <p>
          &copy; <span id="year"></span> Mejor Vida Insurance LLC. All rights reserved.
        </p>
        <p>
          P.O. Box 21885, Lincoln, NE 68542
        </p>
        <p data-lang="es">
          Julie es una productora de seguros autorizada en el estado de Nebraska para Accident and Health or Sickness y Life.
        </p>
        <p data-lang="en" style="display:none;">
          Julie is a licensed insurance producer in the State of Nebraska for Accident and Health or Sickness, and Life.
        </p>
        <p>
          <span data-lang="es">Tel: </span><span data-lang="en" style="display:none;">Phone: </span>
          <a href="tel:5312291712">(531) 229‚Äë1712</a> |
          <a href="mailto:Julie@mejorvidainsurance.com">Julie@mejorvidainsurance.com</a>
        </p>
        <p>
          <a href="privacy-policy.html" data-lang="es">Pol√≠tica de Privacidad</a> | 
          <a href="terms-service.html" data-lang="es">T√©rminos de Servicio</a>
          <a href="privacy-policy.html" data-lang="en" style="display:none;">Privacy Policy</a> | 
          <a href="terms-service.html" data-lang="en" style="display:none;">Terms of Service</a>
        </p>
      </div>
      <div class="footer-right">
        <span data-lang="es">S√≠guenos:</span>
        <span data-lang="en" style="display:none;">Follow us:</span>

        <!-- Font Awesome social icons -->
        <a
          href="https://www.facebook.com/"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Facebook"
        >
          <i class="fab fa-facebook-f"></i>
        </a>
        <a
          href="https://www.instagram.com/"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Instagram"
        >
          <i class="fab fa-instagram"></i>
        </a>
        <a
          href="https://www.linkedin.com/"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="LinkedIn"
        >
          <i class="fab fa-linkedin-in"></i>
        </a>
      </div>
    </div>
  </footer>

  <!-- Agent CRM Modal HTML (hidden by default) -->
  <div id="quoteModal" class="quote-modal" aria-hidden="true" role="dialog" aria-labelledby="quoteModalTitle">
    <div class="quote-modal-backdrop" data-close-modal></div>
    <div class="quote-modal-panel" role="document">
      <!-- Modal header with logo + centered title -->
      <div class="quote-modal-header" role="banner">
        <div class="modal-logo" aria-hidden="true">
          <img src="img/logo-spanish.png" alt="Mejor Vida Insurance" />
        </div>

        <div class="modal-title-wrap" aria-hidden="true">
          <div class="quote-modal-title" data-lang="es">Mejor Vida Insurance ‚Äî Cotizaci√≥n gratuita</div>
          <div class="quote-modal-title" data-lang="en" style="display:none;">Mejor Vida Insurance ‚Äî Free Quote</div>
          <div class="quote-modal-subtitle" data-lang="es">Completa el formulario a continuaci√≥n y Julie te contactar√°</div>
          <div class="quote-modal-subtitle" data-lang="en" style="display:none;">Fill out the form below and Julie will reach out</div>
        </div>

        <button class="quote-modal-close" aria-label="Cerrar" data-close-modal>&times;</button>
      </div>

      <div class="quote-iframe-wrap" aria-live="polite">
        <div class="quote-iframe-inner" id="quoteIframeInner">
          <!-- Agent CRM iframe embed -->
          <iframe
              id="quoteEmbedIframe"
              src="https://crm.mejorvidainsurance.com/widget/form/uApX9m6VUhke3XRK4Iov"
              title="MVI-Final Expense ‚Äì Quote Form (Spanish)"
              frameborder="0"
              scrolling="yes"
              aria-label="Formulario de cotizaci√≥n"
          ></iframe>
        </div>

        <!-- Agent CRM embed script (keeps iframe functionality) -->
        <script src="https://crm.mejorvidainsurance.com/js/form_embed.js"></script>
      </div>
    </div>
  </div>

  <script src="script.js"></script>

  <!-- Guarded language & small page-init script (no global bindings to avoid duplicate-declaration errors) -->
  <script>
    // Run only once and avoid creating global identifiers that conflict with other scripts.
    if (!window._mviLangGuard) {
      window._mviLangGuard = true;

      (function() {
        // local variables only
        var btns = document.querySelectorAll('.lang-btn');
        var currentLanguage = 'es';

        function setLanguage(lang) {
          currentLanguage = lang;

          document.querySelectorAll('[data-lang="es"]').forEach(function(el) {
            el.style.display = lang === 'es' ? '' : 'none';
          });
          document.querySelectorAll('[data-lang="en"]').forEach(function(el) {
            el.style.display = lang === 'en' ? '' : 'none';
          });

          btns.forEach(function(b) {
            if (b.dataset.langBtn === lang) b.classList.add('active');
            else b.classList.remove('active');
          });
        }

        btns.forEach(function(b) {
          b.addEventListener('click', function() {
            setLanguage(b.dataset.langBtn);
          });
        });

        // default
        setLanguage('es');

        // set footer year (local var)
        var yearSpan = document.getElementById('year');
        if (yearSpan) yearSpan.textContent = new Date().getFullYear();
      })();
    }
  </script>

  <!-- Modal control script: opens/closes modal, prefill support, dynamic iframe sizing -->
  <script>
    (function() {
      var modal = document.getElementById('quoteModal');
      var iframe = document.getElementById('quoteEmbedIframe');
      var closeControls = modal.querySelectorAll('[data-close-modal]');
      var openButtons = document.querySelectorAll('.open-quote-modal');
      var modalPanel = modal.querySelector('.quote-modal-panel');
      var modalHeader = modal.querySelector('.quote-modal-header');

      var iframeBaseSrc = iframe.getAttribute('src');

      function buildIframeSrcWithPrefill(params) {
        var allowed = ['first','last','email','phone'];
        var qsParts = [];
        allowed.forEach(function(k) {
          if (params && params[k]) {
            qsParts.push(encodeURIComponent(k) + '=' + encodeURIComponent(params[k]));
          }
        });
        if (qsParts.length === 0) return iframeBaseSrc;
        return iframeBaseSrc + (iframeBaseSrc.indexOf('?') === -1 ? '?' : '&') + qsParts.join('&');
      }

      function sizeIframeToViewport() {
        var panelHeight = modalPanel.clientHeight;
        var headerHeight = modalHeader ? modalHeader.offsetHeight : 0;
        var available = Math.max(600, panelHeight - headerHeight - 20);
        iframe.style.height = available + 'px';
      }

      function openQuoteModal(event, options) {
        if (event && typeof event.preventDefault === 'function') event.preventDefault();

        var params = {};
        if (options && options.prefill && typeof options.prefill === 'object') {
          params = options.prefill;
        } else {
          var pageParams = new URLSearchParams(window.location.search);
          ['first','last','email','phone'].forEach(function(k) {
            if (pageParams.get(k)) params[k] = pageParams.get(k);
          });
        }

        iframe.src = buildIframeSrcWithPrefill(params);

        modal.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';

        setTimeout(function() {
          sizeIframeToViewport();
        }, 100);

        var closeBtn = modal.querySelector('[data-close-modal]');
        if (closeBtn) closeBtn.focus();
      }

      function closeQuoteModal(event) {
        if (event && typeof event.preventDefault === 'function') event.preventDefault();
        modal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
      }

      openButtons.forEach(function(btn) {
        btn.addEventListener('click', openQuoteModal);
        btn.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openQuoteModal(e);
          }
        });
      });

      closeControls.forEach(function(el) {
        el.addEventListener('click', closeQuoteModal);
      });

      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.getAttribute('aria-hidden') === 'false') closeQuoteModal();
      });

      modal.querySelector('.quote-modal-backdrop').addEventListener('click', closeQuoteModal);

      var params = new URLSearchParams(window.location.search);
      if (params.get('openQuote') === '1') {
        var prefill = {};
        ['first','last','email','phone'].forEach(function(k) {
          if (params.get(k)) prefill[k] = params.get(k);
        });

        setTimeout(function() { openQuoteModal(null, { prefill: prefill }); }, 300);

        if (history.replaceState) {
          var url = new URL(window.location.href);
          url.searchParams.delete('openQuote');
          url.searchParams.delete('first');
          url.searchParams.delete('last');
          url.searchParams.delete('email');
          url.searchParams.delete('phone');
          history.replaceState({}, '', url.pathname + url.search);
        }
      }

      window.addEventListener('resize', function() {
        if (modal.getAttribute('aria-hidden') === 'false') {
          clearTimeout(window._quoteResizeTimer);
          window._quoteResizeTimer = setTimeout(sizeIframeToViewport, 80);
        }
      });

      // Expose global functions for the chatbot to call
      window.openQuoteFormModal = function(prefillObj) {
        openQuoteModal(null, { prefill: prefillObj || {} });
      };

      window.closeQuoteFormModal = closeQuoteModal;
    })();
  </script>

  <!-- Diagnostic postMessage listener (debugging) -->
  <script>
    (function() {
      // While debugging we log origin and message contents. Once confirmed working, change isAllowedOrigin to a strict whitelist.
      function isAllowedOrigin(origin) {
        console.log('[postMessage] origin:', origin);
        // TEMP: allow all while debugging
        return true;
        // Example strict check (uncomment for production, adjust as needed):
        // return !!origin && (origin.includes('leadconnectorhq.com') || origin.includes('crm.mejorvidainsurance.com'));
      }

      window.addEventListener('message', function(event) {
        try {
          console.groupCollapsed('[Chatbot message] origin: ' + event.origin);
          console.log('raw event.data:', event.data);

          if (!isAllowedOrigin(event.origin)) {
            console.warn('Origin not allowed:', event.origin);
            console.groupEnd();
            return;
          }

          var data = event.data;
          if (typeof data === 'string') {
            try {
              data = JSON.parse(data);
              console.log('parsed JSON from string message:', data);
            } catch (err) {
              console.warn('message data is string but not valid JSON:', data);
            }
          }

          console.log('normalized data:', data);
          console.groupEnd();

          var isOpenAction = data && (data.action === 'openQuoteForm' || data.openQuoteForm === true);
          if (isOpenAction) {
            var prefill = data.prefill && typeof data.prefill === 'object' ? data.prefill : {};
            if (typeof window.openQuoteFormModal === 'function') {
              try {
                window.openQuoteFormModal(prefill);
                console.log('openQuoteFormModal called with prefill:', prefill);
              } catch (err) {
                console.error('Error calling openQuoteFormModal:', err);
              }
            } else {
              console.warn('openQuoteFormModal not defined yet.');
            }
          }
        } catch (err) {
          console.error('Error handling postMessage:', err);
        }
      });
    })();
  </script>

  <!-- LeadConnectorHQ / widget loader -->
  <script 
    src="https://widgets.leadconnectorhq.com/loader.js"  
    data-resources-url="https://widgets.leadconnectorhq.com/chat-widget/loader.js" 
    data-widget-id="6935d169d355bd236df7342d"   > 
  </script>
</body>
</html>
